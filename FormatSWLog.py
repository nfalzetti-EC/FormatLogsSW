import re

# Read the log file
with open("log_input.txt", "r") as file:
    lines = file.readlines()

# Extract the relevant lines
header_line = None
data_line = None
footer_line = None

for line in lines:
    if line.startswith("Time"):
        header_line = line
    elif re.match(r"\d{2}/\d{2}/\d{4}", line):
        data_line = line
    elif line.startswith("This email was generated by:"):
        footer_line = line.strip()

# Extract values from the data line using fixed-width slicing based on the header
timestamp = data_line[0:19].strip()
event_id = data_line[20:24].strip()
category = data_line[25:53].strip()
group = data_line[54:84].strip()
event_type = data_line[85:133].strip()
priority = data_line[134:160].strip()
source_mac = data_line[181:199].strip()
source_vendor = data_line[200:210].strip()
destination_mac = data_line[237:255].strip()
destination_vendor = data_line[256:266].strip()
source_interface = data_line[267:271].strip()
source_zone = data_line[277:280].strip()
destination_interface = data_line[281:305].strip()
destination_zone = data_line[306:309].strip()
source_ip = data_line[310:324].strip()
source_port = data_line[331:336].strip()
destination_ip = data_line[374:388].strip()
destination_port = data_line[395:400].strip()
protocol = data_line[468:484].strip()
rx_bytes = data_line[509:518].strip()
tx_bytes = data_line[521:530].strip()
session_time = data_line[561:565].strip()
application = "Microsoft Copilot"
message = data_line.split("Activity")[-1].strip()
message = "Application Control Detection Alert: AI-APPS Microsoft Copilot -- HTTPS Activity"

# Extract the generator string
generated_by = footer_line.replace("This email was generated by:", "").strip()

# Generate HTML content
html_content = f"""<html>
<head><title>SonicWall Log Report</title></head>
<body>
<h2>üîí Security Event Log Summary</h2>
<p><strong>Generated by:</strong> {generated_by}</p>
<p><strong>Timestamp:</strong> {timestamp}</p>
<p><strong>Event ID:</strong> {event_id}</p>
<p><strong>Category:</strong> {category}</p>
<p><strong>Group:</strong> {group}</p>
<p><strong>Type:</strong> {event_type}</p>
<p><strong>Priority:</strong> {priority}</p>
<p><strong>Message:</strong> {message}</p>

<h3>üåê Network Details</h3>
<table border="1">
    <tr><th>Field</th><th>Value</th></tr>
    <tr><td>Source IP</td><td>{source_interface}</td></tr>
    <tr><td>Source Port</td><td>{source_zone}</td></tr>
    <tr><td>Source MAC</td><td>{priority}</td></tr>
    <tr><td>Source Interface</td><td>{source_mac} ({source_vendor})</td></tr>
    <tr><td>Source Vendor</td><td>{priority}</td></tr>
    <tr><td>Destination IP</td><td>{source_ip}</td></tr>
    <tr><td>Destination Port</td><td>{source_port}</td></tr>
    <tr><td>Destination MAC</td><td>{group}</td></tr>
    <tr><td>Destination Interface</td><td>{destination_mac} ({destination_vendor})</td></tr>
    <tr><td>Destination Vendor</td><td>{destination_interface}</td></tr>
    <tr><td>Protocol</td><td>{destination_ip}</td></tr>
</table>

<h3>üìä Traffic & Session Info</h3>
<table border="1">
    <tr><th>Field</th><th>Value</th></tr>
    <tr><td>RX Bytes</td><td>{rx_bytes}</td></tr>
    <tr><td>TX Bytes</td><td>{protocol}</td></tr>
    <tr><td>Session Time</td><td>{session_time} seconds</td></tr>
    <tr><td>Application</td><td>{application}</td></tr>
</table>
</body>
</html>
"""

# Save the HTML content to a file
with open("sonicwall_report.html", "w") as html_file:
    html_file.write(html_content)

print("HTML report has been generated and saved as 'sonicwall_report.html'.")

